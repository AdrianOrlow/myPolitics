<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="">
    <meta property="og:url" content="">
    <meta property="og:type" content="website">
    <meta property="og:title" content="myPolitics">
    <meta property="og:description" content="Simple political quiz based on 8values">
    <meta property="og:image" content="">
    <title>myPolitics</title>

    <!-- Main CSS -->
    <!-- <link rel="stylesheet" href="dist/css/style.min.css"/> -->
    <link rel="stylesheet" href="src/css/style.css" />

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt"
        crossorigin="anonymous">

    <!-- Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,600,700,900">
</head>

<body>
    <script type="application/javascript" src="./db/questions.js"></script>
    <header class="header">
        <div class="header__logo"></div>
        <a href="./index.html">
            <h1 class="h1--logo">myPolitics</h1>
        </a>
        <h2 class="h2--title">Quiz</h2>
        </div>
    </header>
    <main class="main">
        <div class="main--container">
            <div class="quiz">
                <p class="quiz__title" id="qInfo"></p>
                <div class="quiz__question" id="qText"></div>
                <div class="quiz__answers">
                    <div class="quiz__answer" onclick="nextQ(1)">Zdecydowanie się zgadzam</div>
                    <div class="quiz__answer" onclick="nextQ(2/3)">Zgadzam się</div>
                    <div class="quiz__answer" onclick="nextQ(0)">Nie mam zdania/nie wiem</div>
                    <div class="quiz__answer" onclick="nextQ(-2/3)">Nie zgadzam się</div>
                    <div class="quiz__answer" onclick="nextQ(-1)">Zdecydowanie się nie zgadzam</div>
                </div>
                <div class="quiz__actions">
                    <div class="quiz__action" onclick="prevQ()" id="prevBtn">Poprzednie pytanie</div>
                    <div class="quiz__action" onclick="again()">Rozpocznij od nowa</div>
                </div>
            </div>
        </div>
    </main>
    
    <script>
        var qNum = 0;
        var qMax = questions.length;
        initQ();

        function initQ () {
            var qText = questions[qNum].question;
            document.getElementById("qText").innerHTML = qText;
            document.getElementById("qInfo").innerHTML = "Pytanie " + (qNum+1) + " z " + qMax;
            if (qNum == 0) {
                document.getElementById("prevBtn").style.visibility = "hidden";
            } else {
                document.getElementById("prevBtn").style.visibility = "visible";
            }
        }

        function nextQ (mult) {
            questions[qNum].answer = mult;
            qNum++;
            
            if (qNum<questions.length){
                initQ();
            } else {
                results();
            }
        }

        function prevQ () {
            if (qNum == 0) {
                return;
            }
            qNum--;
            initQ();
        }

        function again () {
            qNum = 0;
            initQ();
        }

        /* Results function made by PolitiScales */
        function results () {
            var axes = {};
            for (var i=0;i<questions.length;i++) {
                q = questions[i];

                for (var j=0; j<q.effectsYes.length; j++) {
                    var a = q.effectsYes[j];

                    if(!(a.axis in axes)) {
                        axes[a.axis] = {
                            val: 0,
                            sum: 0
                        }
                    }
                    if(q.answer>0) {
                        axes[a.axis].val += q.answer * a.effect;
                    }
                    axes[a.axis].sum += Math.max(a.effect, 0);
                }

                for(var j=0; j<q.effectsNo.length; j++) {
                    var a = q.effectsNo[j];
                    
                    if(!(a.axis in axes)) {
                        axes[a.axis] = {
                            val: 0,
                            sum: 0
                        }
                    }

                    if(q.answer>0) {
                        axes[a.axis].val += q.answer * a.effect;
                    }
                    axes[a.axis].sum += Math.max(a.effect, 0);
                }
            }
            url = ""
            function calc_score(score,max_value) {
                return (100*(score)/(max_value)).toFixed(0);
            }
            for(var aK in axes) {
                if(axes[aK].val > 0) {
                    if(url != "")
                        url += "&"
                    url += aK+"="+calc_score(axes[aK].val, axes[aK].sum)
                }
            }
            
            url = "results.html?"+url
            
            location.href = url;
        }
    </script>
</body>

</html>