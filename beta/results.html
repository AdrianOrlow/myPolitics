<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#fafafa">
    <meta property="og:url" content="https://mypolitics.orlow.me/results.html">
    <meta property="og:type" content="website">
    <meta property="og:title" content="myPolitics - wyniki">
    <meta property="og:description" content="Prosty test polityczny pokazujący twoje poglądy na siedmiu osiach.">
    <meta property="og:image" content="https://mypolitics.orlow.me/img/thumbnails/results.png">
    <title>myPolitics BETA</title>

    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="https://mypolitics.orlow.me/img/ico/favicon.ico">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-51375799-4"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'UA-51375799-5');
    </script>

    <!-- Main CSS -->
    <!-- <link rel="stylesheet" href="../dist/css/style.min.css" /> -->
    <link rel="stylesheet" href="../src/css/style.css" />

    <!-- Normalize CSS -->
    <link rel="stylesheet" href="../dist/css/normalize.min.css" />

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt"
        crossorigin="anonymous">

    <!-- Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,600,700,900">
</head>

<body>
    <script type="application/javascript" src="../db/ideologiesInfo.js"></script>
    <script type="application/javascript" src="../db/ideologies.js"></script>
    <header id="header" class="header">
        <div class="header__logo"></div>
        <a href="./index.html">
            <h1 class="h1--logo">myPolitics</h1>
        </a>
        <h2 class="h2--title">BETA - Wyniki</h2>
        </div>
    </header>
    <main class="main" id="main">
        <div class="main--container">
            <div class="axis">
                <div onclick="showInfo('communism')" class="icon icon--communism icon--notfa"></div>
                <div class="bars">
                    <div class="bar bar--communism" id="a1"></div>
                    <div class="bar bar--grey" id="a0"></div>
                    <div class="bar bar--capitalism" id="a2"></div>
                </div>
                <div onclick="showInfo('capitalism')" class="icon icon--capitalism"></div>
            </div>
            <div class="axis">
                <div onclick="showInfo('regulationism')" class="icon icon--regulationism"></div>
                <div class="bars">
                    <div class="bar bar--regulationism" id="b1"></div>
                    <div class="bar bar--grey" id="b0"></div>
                    <div class="bar bar--laissezfaire" id="b2"></div>
                </div>
                <div onclick="showInfo('laissezfaire')" class="icon icon--laissezfaire"></div>
            </div>
            <div class="axis">
                <div onclick="showInfo('anarchism')" class="icon icon--anarchism icon--notfa"></div>
                <div class="bars">
                    <div class="bar bar--anarchism" id="c1"></div>
                    <div class="bar bar--grey" id="c0"></div>
                    <div class="bar bar--authoritarianism" id="c2"></div>
                </div>
                <div onclick="showInfo('authoritarianism')" class="icon icon--authoritarianism"></div>
            </div>
            <div class="axis">
                <div onclick="showInfo('pacifism')" class="icon icon--pacifism"></div>
                <div class="bars">
                    <div class="bar bar--pacifism" id="d1"></div>
                    <div class="bar bar--grey" id="d0"></div>
                    <div class="bar bar--militarism" id="d2"></div>
                </div>
                <div onclick="showInfo('militarism')" class="icon icon--militarism"></div>
            </div>
            <div class="axis">
                <div onclick="showInfo('environmentalism')" class="icon icon--environmentalism"></div>
                <div class="bars">
                    <div class="bar bar--environmentalism" id="e1"></div>
                    <div class="bar bar--grey" id="e0"></div>
                    <div class="bar bar--anthropocentrism" id="e2"></div>
                </div>
                <div onclick="showInfo('anthropocentrism')" class="icon icon--anthropocentrism"></div>
            </div>
            <div class="axis">
                <div onclick="showInfo('progressivism')" class="icon icon--progressivism"></div>
                <div class="bars">
                    <div class="bar bar--progressivism" id="f1"></div>
                    <div class="bar bar--grey" id="f0"></div>
                    <div class="bar bar--traditionalism" id="f2"></div>
                </div>
                <div onclick="showInfo('traditionalism')" class="icon icon--traditionalism"></div>
            </div>
            <div class="axis">
                <div onclick="showInfo('cosmopolitanism')" class="icon icon--cosmopolitanism"></div>
                <div class="bars">
                    <div class="bar bar--cosmopolitanism" id="g1"></div>
                    <div class="bar bar--grey" id="g0"></div>
                    <div class="bar bar--nationalism" id="g2"></div>
                </div>
                <div onclick="showInfo('nationalism')" class="icon icon--nationalism"></div>
            </div>
            <div class="ideology--container">
                <div>Najbliższa ideologia: <span id="ideoText"></span></div>
            </div>
            <div class="compass--container"><img src="../img/svg/chart.svg">
                <div id="cPointer" class="compass__pointer"></div>
            </div>
            <div class="more--container" id="mContainer">
                <div class="more__title">Cechy</div>
            </div>
            <a class="btn--feedback" href="hhttps://goo.gl/forms/MhgntAQl68AJJN1J2">Błąd?</a>
        </div>
    </main>
    <div id="popup" class="modal--wrapper block--none" onclick="hideInfo()">
        <div class="modal--info">
            <div id="modalTitle" class="info--name"></div>
            <div id="modalIcon" class="info--symbol"></div>
            <div id="modalText" class="info--container"></div>
        </div>
    </div>
    <div id="popupInfo" class="modal--wrapper" onclick="hideInfo(); setCookie('popupClosed','true')">
        <div class="modal--info" style="height: 15em;">
            <div class="info--container" style="margin-top: 0;height: 80%;padding: 5%;">
                <div class="modal--text">Tutaj pokażą się twoje wyniki oparte na uzyskanych punktach w każdej
                    ideologii.

                    Jeśli jakiejś nie znasz, to możesz kliknąć na jej ikonę, a wyświetli się krótki opis.</div>
            </div>
        </div>
    </div>

    <script src="../src/js/cookies.js"></script>
    <script>
        var values = ["popup", "modalTitle", "modalIcon", "modalText", "main", "header", "popupInfo", "ideoText",
            "cPointer", "mContainer"
        ];
        values.forEach(value => {
            var value = document.getElementById(value);
        });

        function checkCookie() {
            if (getCookie("popupClosed") == "true") {
                main.classList.remove("block--blur");
                header.classList.remove("block--blur");
                popupInfo.classList.add("block--none");
            }
        }

        main.classList.add("block--blur");
        header.classList.add("block--blur");
        checkCookie();

        function showInfo(choice) {
            for (var i = 0; i < ideologiesInfo.length; i++) {
                var ideology = ideologiesInfo[i];
                if (ideology.title == choice) {
                    modalTitle.innerHTML = ideology.name;
                    modalText.innerHTML = ideology.desc;

                    modalTitle.classList.add("bar--" + choice);
                    modalIcon.classList.add("icon--" + choice);
                    main.classList.add("block--blur");
                    header.classList.add("block--blur");

                    if (modalIcon.classList.contains("icon--anarchism" || "icon--communism" || "icon--an")) {
                        modalIcon.classList.add("icon--notfa");
                    }

                    popup.classList.remove("block--none");
                    window.scrollTo(0, 0);
                    return;
                }
            }
        }

        function hideInfo() {
            main.classList.remove("block--blur");
            header.classList.remove("block--blur");
            modalTitle.classList = "info--name";
            modalIcon.className = "info--symbol";
            if (!popup.classList.contains("block--none")) {
                popup.classList.add("block--none");
            } else {
                popupInfo.classList.add("block--none");
            }
        }

        function calcResult(value) {
            var values = window.location.search.substring(1).split("&");
            for (var i = 0; i < values.length; i++) {
                var pair = values[i].split("=")
                if (pair[0] == value) {
                    if (pair[1] == "NaN") {
                        return;
                    } else {
                        return pair[1];
                    }
                }
            }
            return;
        }

        function showResults() {
            var axes = ["a1", "a2", "b1", "b2", "c1", "c2", "d1", "d2", "e1", "e2", "f1", "f2", "g1", "g2"];

            for (var i = 0; i < axes.length; i += 2) {
                var axis = axes[i];
                var opResult = parseInt(calcResult(axes[i])) + parseInt(calcResult(axes[i + 1]));
                var diffrence = 100 - opResult;
                var diffEl = document.getElementById(axes[i].replace(/.$/, "0"));
                if (diffrence != 0 || isNaN(opResult)) {
                    if (isNaN(opResult) && parseInt(calcResult(axes[i + 1])) !== 100) {
                        diffrence = 100;
                    } else if (calcResult(axes[i + 1]) == 100) {
                        diffrence = 0;
                    }
                    if (diffrence >= 20) {
                        diffEl.innerHTML = diffrence + " %";
                    }
                    diffEl.style.width = diffrence + "%";
                }

                for (var j = 0; j <= 2; j++) {
                    var cR = calcResult(axis);
                    if (cR >= 20) {
                        document.getElementById(axis).innerHTML = cR + " %";
                    }
                    if (opResult > 100 && j == 0) {
                        cR -= 1;
                    }
                    document.getElementById(axis).style.width = cR + "%";
                    axis = axes[i + 1];
                }
            }
        }

        function findIdeology() {
            ideology = "";
            ideodist = Infinity;
            var econResultsAxes = ["a1", "a2", "b1", "b2"];
            econResultsAxes.forEach(el => {
                var el = parseInt(calcResult(el));
            });
            for (var i = 0; i < ideologies.length; i++) {
                dist = 0;
                dist += Math.pow(Math.abs(
                    ideologies[i].effects.b1 -
                    ((
                        (parseInt(calcResult("a1")) + ((100 - (parseInt(calcResult("a2")) + parseInt(
                            calcResult("a1")))) / 3)) +
                        (parseInt(calcResult("b1")) + ((100 - (parseInt(calcResult("b2")) + parseInt(
                            calcResult("b1")))) / 3))
                    ) / 2)
                ), 2);
                dist += Math.pow(Math.abs(ideologies[i].effects.c1 - calcResult('c1')), 2);
                dist += Math.pow(Math.abs(ideologies[i].effects.d1 - calcResult('d1')), 1.73856063);
                dist += Math.pow(Math.abs(ideologies[i].effects.f1 - calcResult('f1')), 1.73856063);
                if (dist < ideodist) {
                    ideology = ideologies[i].name;
                    ideodist = dist;
                }
            }
            ideoText.innerHTML = ideology;
        }

        function findTraits() {
            var traits = ["mo", "an", "re"];

            traits.forEach(trait => {
                for (var i = 0; i < ideologiesInfo.length; i++) {
                    var ideology = ideologiesInfo[i];
                    if (ideology.title == trait && calcResult(trait) == 100) {
                        var traitEl = document.createElement("div");

                        traitEl.innerHTML = ideology.name;
                        traitEl.classList.add("more__el");
                        traitEl.onclick = function () {
                            showInfo(trait);
                        }
                        mContainer.appendChild(traitEl);
                    }
                }
            })
        }

        function calcCompass() {
            var eAxis = (((parseInt(calcResult("a1")) + ((100 - (parseInt(calcResult("a2")) + parseInt(calcResult("a1")))) /
                3)) + (parseInt(calcResult("b1")) + ((100 - (parseInt(calcResult("b2")) + parseInt(
                calcResult("b1")))) / 3))) / 2) - 50;
            var sAxis = (((parseInt(calcResult("c1")) + ((100 - (parseInt(calcResult("c2")) + parseInt(calcResult("c1")))) /
                3)) + (parseInt(calcResult("d1")) + ((100 - (parseInt(calcResult("d2")) + parseInt(
                calcResult("d1")))) / 3))) / 2) - 50;

            cPointer.style.left = "calc(" + (45 - eAxis) + "% + 6px)";
            cPointer.style.top = "calc(" + (45 + sAxis) + "% + 6px)";
        }

        showResults();
        findIdeology();
        findTraits();
        calcCompass();
    </script>
</body>

</html>